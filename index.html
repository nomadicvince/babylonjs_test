<!doctype html>
<html>
<head>
   <meta charset="utf-8">
   <title>Babylon.js Loader Test</title>
   <style>
      html, body {
         overflow: hidden;
         width: 100%;
         height: 100%;
         margin: 0;
         padding: 0;
      }
      #renderCanvas {
         width: 100%;
         height: 100%;
         touch-action: none;
      }
   </style>
   <script src="http://cdn.babylonjs.com/2-5/babylon.js"></script>
</head>
<body>
   <canvas id="renderCanvas"></canvas>
   <script>
       if (BABYLON.Engine.isSupported()) {
           var canvas = document.getElementById("renderCanvas");
           var engine = new BABYLON.Engine(canvas, true);

           BABYLON.SceneLoader.Load("data/", "bed_test.babylon", engine, function (newScene) {
               // Wait for textures and shaders to be ready
               newScene.executeWhenReady(function () {
                   // Attach camera to canvas inputs
                   newScene.activeCamera.attachControl(canvas);
                   newScene.activeCamera.upperBetaLimit = Math.PI / 2;
                   newScene.activeCamera.lowerRadiusLimit = 4;

                   //Environment HDRI
                   var skybox = BABYLON.Mesh.CreateBox("skyBox", 100.0, newScene);
                   var skyboxMaterial = new BABYLON.StandardMaterial("skyBox", newScene);
                   skyboxMaterial.backFaceCulling = false;
                   skyboxMaterial.disableLighting = true;
                   skybox.infiniteDistance = true;
                   skyboxMaterial.reflectionTexture = new BABYLON.CubeTexture("sky/sunset", newScene, ["_px.png", "_py.png", "_pz.png", "_nx.png", "_ny.png", "_nz.png"]);
                   skyboxMaterial.reflectionTexture.coordinatesMode = BABYLON.Texture.SKYBOX_MODE;
                   skybox.material = skyboxMaterial;
                   //Lights
                   var light = new BABYLON.DirectionalLight("Dir", new BABYLON.Vector3(0, -1, 0), newScene);
                   light.diffuse = new BABYLON.Color3(1, 1, 1);
                   light.specular = new BABYLON.Color3(1, 1, 1);

                   //PBR Materials and textures
                   var reflectionTexture = new BABYLON.CubeTexture("sky/sunset", newScene);

                   //Carpet
                   var carpetTexture = new BABYLON.Texture("textures/carpet_texture.jpg", newScene);
                   //carpetTexture.uScale = 1;
                   //carpetTexture.vScale = 50;

                   var carpetMat = new BABYLON.PBRMaterial("Carpet", newScene);
                   carpetMat.albedoTexture = carpetTexture;
                   carpetMat.reflectivityColor = new BABYLON.Color3(1, 0.7, 0.5);
                   //carpetMat.albedoColor = new BABYLON.Color3(1, 1, 1);
                   //carpetMat.microSurface = 0.1;
                  // carpetMat.directIntensity = .7;
                   //carpetMat.environmentIntensity = 1;
                   //carpetMat.cameraExposure = 0.86;
                  // carpetMat.cameraContrast = 1.66;
                   //carpetMat.reflectionTexture = reflectionTexture;

                   var carpet = newScene.getMeshByName("Carpet");
                   carpet.material = carpetMat;

                   // Once the scene is loaded, just register a render loop to render it
                   engine.runRenderLoop(function() {
                       newScene.render();
                   });
               });
           }, function (progress) {
               // To do: give progress feedback to user
           });
       }
   </script>
</body>
</html>
